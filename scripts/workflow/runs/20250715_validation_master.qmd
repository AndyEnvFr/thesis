---
title: "run file"
format: html
editor: visual
---

I implemented ndd and pdd. The Process works for small runs. Here, I run it in a batch for bigger runs. This is a first test, however, the setitngs are chosen to be evaluated in my thesis.

```{r}
#| warning: false
library(PhyloSim)
library(parallel)
# root <- "~/Uni/Master/MA/" # work from local machine
root <- "~/cyber_synch/" # work from uni bayreuth server
# source(paste0(root, "/git_synch/scripts/functions.R"))
```

### define params and run model

```{r}
density_options <- c(0, 0.1, 0.5, 0.8,  1)
dispersal_options <- list(1)
densityCut_options <- c(1, 2)
fitnessBaseMortalityRatio_options <- c(10, 20, 30)
environment_options <- c(0)
seed_options <- c(20250701)

# Initialize empty list for parameters
params <- list()
param_index <- 1

# Generate all parameter combinations
for (density in density_options) {
  for (dispersal_type in dispersal_options) {
    for (cut in densityCut_options) {
      for (fbmr in fitnessBaseMortalityRatio_options) {
        for (env in environment_options) {  # << neue Schleife
          for (current_seed in seed_options) {
            
            scenario_density <- gsub("\\.", "-", as.character(density))
            scenario_dispersal <- ifelse(identical(dispersal_type, "global"), "G", dispersal_type)
            scenario_cut <- gsub("\\.", "-", as.character(cut))
            scenario_fbmr <- gsub("\\.", "-", as.character(fbmr))
            scenario_env <- gsub("\\.", "-", as.character(env))
            scenario_seed_suffix <- substr(as.character(current_seed), nchar(as.character(current_seed)) - 1, nchar(as.character(current_seed)))
            
            params[[param_index]] <- createCompletePar(
              x = 50,
              y = 50,
              density = density,
              dispersal = dispersal_type,
              specRate = 2,
              environment = env,
              fitnessBaseMortalityRatio = fbmr,
              densityCut = cut,
              seed = current_seed,
              type = "base",
              protracted = 0,
              fission = 0,
              redQueen = 0,
              redQueenStrength = 0,
              airmat = 0,
              fitnessActsOn = "mortality",
              runs =  sort(c((1:150 * 17500), (1:150 * 17500) + 1 )),
              scenario = paste0("dd", scenario_density,
                                "_disp", scenario_dispersal,
                                "_sr2_e", scenario_env,
                                "_m", scenario_fbmr,
                                "_cut", scenario_cut,
                                "_seed", scenario_seed_suffix)
            )
            
            param_index <- param_index + 1
          }
        }
      }
    }
  }
}
```


```{r}
runz <- runSimulationBatch(params, parallel = 30, backup = FALSE)
saveRDS(runz, "~/cyber_synch/local/runs/fat/new/OrigRun")
```
For the raw model with [parallel = 30] this happened: 
Error: WARNING: Session forced to suspend due to system upgrade, restart, maintenance, or other issue. Your session data was saved however running computations may have been interrupted.

Now I try with noPhylOut still [parallel = 30]:

```{r}
runz <- runSimulation(params1[[1]])
```


